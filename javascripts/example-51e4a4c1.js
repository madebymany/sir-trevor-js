!function(){var t=this,e=t._,n={},i=Array.prototype,o=Object.prototype,r=Function.prototype,s=i.push,a=i.slice,l=i.concat,c=o.toString,u=o.hasOwnProperty,d=i.forEach,h=i.map,p=i.reduce,f=i.reduceRight,m=i.filter,b=i.every,g=i.some,v=i.indexOf,k=i.lastIndexOf,_=Array.isArray,y=Object.keys,B=r.bind,w=function(t){return t instanceof w?t:this instanceof w?(this._wrapped=t,void 0):new w(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=w),exports._=w):t._=w,w.VERSION="1.4.4";var x=w.each=w.forEach=function(t,e,i){if(null!=t)if(d&&t.forEach===d)t.forEach(e,i);else if(t.length===+t.length){for(var o=0,r=t.length;r>o;o++)if(e.call(i,t[o],o,t)===n)return}else for(var s in t)if(w.has(t,s)&&e.call(i,t[s],s,t)===n)return};w.map=w.collect=function(t,e,n){var i=[];return null==t?i:h&&t.map===h?t.map(e,n):(x(t,function(t,o,r){i[i.length]=e.call(n,t,o,r)}),i)};var C="Reduce of empty array with no initial value";w.reduce=w.foldl=w.inject=function(t,e,n,i){var o=arguments.length>2;if(null==t&&(t=[]),p&&t.reduce===p)return i&&(e=w.bind(e,i)),o?t.reduce(e,n):t.reduce(e);if(x(t,function(t,r,s){o?n=e.call(i,n,t,r,s):(n=t,o=!0)}),!o)throw new TypeError(C);return n},w.reduceRight=w.foldr=function(t,e,n,i){var o=arguments.length>2;if(null==t&&(t=[]),f&&t.reduceRight===f)return i&&(e=w.bind(e,i)),o?t.reduceRight(e,n):t.reduceRight(e);var r=t.length;if(r!==+r){var s=w.keys(t);r=s.length}if(x(t,function(a,l,c){l=s?s[--r]:--r,o?n=e.call(i,n,t[l],l,c):(n=t[l],o=!0)}),!o)throw new TypeError(C);return n},w.find=w.detect=function(t,e,n){var i;return D(t,function(t,o,r){return e.call(n,t,o,r)?(i=t,!0):void 0}),i},w.filter=w.select=function(t,e,n){var i=[];return null==t?i:m&&t.filter===m?t.filter(e,n):(x(t,function(t,o,r){e.call(n,t,o,r)&&(i[i.length]=t)}),i)},w.reject=function(t,e,n){return w.filter(t,function(t,i,o){return!e.call(n,t,i,o)},n)},w.every=w.all=function(t,e,i){e||(e=w.identity);var o=!0;return null==t?o:b&&t.every===b?t.every(e,i):(x(t,function(t,r,s){return(o=o&&e.call(i,t,r,s))?void 0:n}),!!o)};var D=w.some=w.any=function(t,e,i){e||(e=w.identity);var o=!1;return null==t?o:g&&t.some===g?t.some(e,i):(x(t,function(t,r,s){return o||(o=e.call(i,t,r,s))?n:void 0}),!!o)};w.contains=w.include=function(t,e){return null==t?!1:v&&t.indexOf===v?-1!=t.indexOf(e):D(t,function(t){return t===e})},w.invoke=function(t,e){var n=a.call(arguments,2),i=w.isFunction(e);return w.map(t,function(t){return(i?e:t[e]).apply(t,n)})},w.pluck=function(t,e){return w.map(t,function(t){return t[e]})},w.where=function(t,e,n){return w.isEmpty(e)?n?null:[]:w[n?"find":"filter"](t,function(t){for(var n in e)if(e[n]!==t[n])return!1;return!0})},w.findWhere=function(t,e){return w.where(t,e,!0)},w.max=function(t,e,n){if(!e&&w.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&w.isEmpty(t))return-1/0;var i={computed:-1/0,value:-1/0};return x(t,function(t,o,r){var s=e?e.call(n,t,o,r):t;s>=i.computed&&(i={value:t,computed:s})}),i.value},w.min=function(t,e,n){if(!e&&w.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&w.isEmpty(t))return 1/0;var i={computed:1/0,value:1/0};return x(t,function(t,o,r){var s=e?e.call(n,t,o,r):t;s<i.computed&&(i={value:t,computed:s})}),i.value},w.shuffle=function(t){var e,n=0,i=[];return x(t,function(t){e=w.random(n++),i[n-1]=i[e],i[e]=t}),i};var T=function(t){return w.isFunction(t)?t:function(e){return e[t]}};w.sortBy=function(t,e,n){var i=T(e);return w.pluck(w.map(t,function(t,e,o){return{value:t,index:e,criteria:i.call(n,t,e,o)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return t.index<e.index?-1:1}),"value")};var $=function(t,e,n,i){var o={},r=T(e||w.identity);return x(t,function(e,s){var a=r.call(n,e,s,t);i(o,a,e)}),o};w.groupBy=function(t,e,n){return $(t,e,n,function(t,e,n){(w.has(t,e)?t[e]:t[e]=[]).push(n)})},w.countBy=function(t,e,n){return $(t,e,n,function(t,e){w.has(t,e)||(t[e]=0),t[e]++})},w.sortedIndex=function(t,e,n,i){n=null==n?w.identity:T(n);for(var o=n.call(i,e),r=0,s=t.length;s>r;){var a=r+s>>>1;n.call(i,t[a])<o?r=a+1:s=a}return r},w.toArray=function(t){return t?w.isArray(t)?a.call(t):t.length===+t.length?w.map(t,w.identity):w.values(t):[]},w.size=function(t){return null==t?0:t.length===+t.length?t.length:w.keys(t).length},w.first=w.head=w.take=function(t,e,n){return null==t?void 0:null==e||n?t[0]:a.call(t,0,e)},w.initial=function(t,e,n){return a.call(t,0,t.length-(null==e||n?1:e))},w.last=function(t,e,n){return null==t?void 0:null==e||n?t[t.length-1]:a.call(t,Math.max(t.length-e,0))},w.rest=w.tail=w.drop=function(t,e,n){return a.call(t,null==e||n?1:e)},w.compact=function(t){return w.filter(t,w.identity)};var E=function(t,e,n){return x(t,function(t){w.isArray(t)?e?s.apply(n,t):E(t,e,n):n.push(t)}),n};w.flatten=function(t,e){return E(t,e,[])},w.without=function(t){return w.difference(t,a.call(arguments,1))},w.uniq=w.unique=function(t,e,n,i){w.isFunction(e)&&(i=n,n=e,e=!1);var o=n?w.map(t,n,i):t,r=[],s=[];return x(o,function(n,i){(e?i&&s[s.length-1]===n:w.contains(s,n))||(s.push(n),r.push(t[i]))}),r},w.union=function(){return w.uniq(l.apply(i,arguments))},w.intersection=function(t){var e=a.call(arguments,1);return w.filter(w.uniq(t),function(t){return w.every(e,function(e){return w.indexOf(e,t)>=0})})},w.difference=function(t){var e=l.apply(i,a.call(arguments,1));return w.filter(t,function(t){return!w.contains(e,t)})},w.zip=function(){for(var t=a.call(arguments),e=w.max(w.pluck(t,"length")),n=new Array(e),i=0;e>i;i++)n[i]=w.pluck(t,""+i);return n},w.object=function(t,e){if(null==t)return{};for(var n={},i=0,o=t.length;o>i;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},w.indexOf=function(t,e,n){if(null==t)return-1;var i=0,o=t.length;if(n){if("number"!=typeof n)return i=w.sortedIndex(t,e),t[i]===e?i:-1;i=0>n?Math.max(0,o+n):n}if(v&&t.indexOf===v)return t.indexOf(e,n);for(;o>i;i++)if(t[i]===e)return i;return-1},w.lastIndexOf=function(t,e,n){if(null==t)return-1;var i=null!=n;if(k&&t.lastIndexOf===k)return i?t.lastIndexOf(e,n):t.lastIndexOf(e);for(var o=i?n:t.length;o--;)if(t[o]===e)return o;return-1},w.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((e-t)/n),0),o=0,r=new Array(i);i>o;)r[o++]=t,t+=n;return r},w.bind=function(t,e){if(t.bind===B&&B)return B.apply(t,a.call(arguments,1));var n=a.call(arguments,2);return function(){return t.apply(e,n.concat(a.call(arguments)))}},w.partial=function(t){var e=a.call(arguments,1);return function(){return t.apply(this,e.concat(a.call(arguments)))}},w.bindAll=function(t){var e=a.call(arguments,1);return 0===e.length&&(e=w.functions(t)),x(e,function(e){t[e]=w.bind(t[e],t)}),t},w.memoize=function(t,e){var n={};return e||(e=w.identity),function(){var i=e.apply(this,arguments);return w.has(n,i)?n[i]:n[i]=t.apply(this,arguments)}},w.delay=function(t,e){var n=a.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},w.defer=function(t){return w.delay.apply(w,[t,1].concat(a.call(arguments,1)))},w.throttle=function(t,e){var n,i,o,r,s=0,a=function(){s=new Date,o=null,r=t.apply(n,i)};return function(){var l=new Date,c=e-(l-s);return n=this,i=arguments,0>=c?(clearTimeout(o),o=null,s=l,r=t.apply(n,i)):o||(o=setTimeout(a,c)),r}},w.debounce=function(t,e,n){var i,o;return function(){var r=this,s=arguments,a=function(){i=null,n||(o=t.apply(r,s))},l=n&&!i;return clearTimeout(i),i=setTimeout(a,e),l&&(o=t.apply(r,s)),o}},w.once=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}},w.wrap=function(t,e){return function(){var n=[t];return s.apply(n,arguments),e.apply(this,n)}},w.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},w.after=function(t,e){return 0>=t?e():function(){return--t<1?e.apply(this,arguments):void 0}},w.keys=y||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var n in t)w.has(t,n)&&(e[e.length]=n);return e},w.values=function(t){var e=[];for(var n in t)w.has(t,n)&&e.push(t[n]);return e},w.pairs=function(t){var e=[];for(var n in t)w.has(t,n)&&e.push([n,t[n]]);return e},w.invert=function(t){var e={};for(var n in t)w.has(t,n)&&(e[t[n]]=n);return e},w.functions=w.methods=function(t){var e=[];for(var n in t)w.isFunction(t[n])&&e.push(n);return e.sort()},w.extend=function(t){return x(a.call(arguments,1),function(e){if(e)for(var n in e)t[n]=e[n]}),t},w.pick=function(t){var e={},n=l.apply(i,a.call(arguments,1));return x(n,function(n){n in t&&(e[n]=t[n])}),e},w.omit=function(t){var e={},n=l.apply(i,a.call(arguments,1));for(var o in t)w.contains(n,o)||(e[o]=t[o]);return e},w.defaults=function(t){return x(a.call(arguments,1),function(e){if(e)for(var n in e)null==t[n]&&(t[n]=e[n])}),t},w.clone=function(t){return w.isObject(t)?w.isArray(t)?t.slice():w.extend({},t):t},w.tap=function(t,e){return e(t),t};var S=function(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof w&&(t=t._wrapped),e instanceof w&&(e=e._wrapped);var o=c.call(t);if(o!=c.call(e))return!1;switch(o){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var r=n.length;r--;)if(n[r]==t)return i[r]==e;n.push(t),i.push(e);var s=0,a=!0;if("[object Array]"==o){if(s=t.length,a=s==e.length)for(;s--&&(a=S(t[s],e[s],n,i)););}else{var l=t.constructor,u=e.constructor;if(l!==u&&!(w.isFunction(l)&&l instanceof l&&w.isFunction(u)&&u instanceof u))return!1;for(var d in t)if(w.has(t,d)&&(s++,!(a=w.has(e,d)&&S(t[d],e[d],n,i))))break;if(a){for(d in e)if(w.has(e,d)&&!s--)break;a=!s}}return n.pop(),i.pop(),a};w.isEqual=function(t,e){return S(t,e,[],[])},w.isEmpty=function(t){if(null==t)return!0;if(w.isArray(t)||w.isString(t))return 0===t.length;for(var e in t)if(w.has(t,e))return!1;return!0},w.isElement=function(t){return!(!t||1!==t.nodeType)},w.isArray=_||function(t){return"[object Array]"==c.call(t)},w.isObject=function(t){return t===Object(t)},x(["Arguments","Function","String","Number","Date","RegExp"],function(t){w["is"+t]=function(e){return c.call(e)=="[object "+t+"]"}}),w.isArguments(arguments)||(w.isArguments=function(t){return!(!t||!w.has(t,"callee"))}),"function"!=typeof/./&&(w.isFunction=function(t){return"function"==typeof t}),w.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},w.isNaN=function(t){return w.isNumber(t)&&t!=+t},w.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==c.call(t)},w.isNull=function(t){return null===t},w.isUndefined=function(t){return void 0===t},w.has=function(t,e){return u.call(t,e)},w.noConflict=function(){return t._=e,this},w.identity=function(t){return t},w.times=function(t,e,n){for(var i=Array(t),o=0;t>o;o++)i[o]=e.call(n,o);return i},w.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var U={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};U.unescape=w.invert(U.escape);var I={escape:new RegExp("["+w.keys(U.escape).join("")+"]","g"),unescape:new RegExp("("+w.keys(U.unescape).join("|")+")","g")};w.each(["escape","unescape"],function(t){w[t]=function(e){return null==e?"":(""+e).replace(I[t],function(e){return U[t][e]})}}),w.result=function(t,e){if(null==t)return null;var n=t[e];return w.isFunction(n)?n.call(t):n},w.mixin=function(t){x(w.functions(t),function(e){var n=w[e]=t[e];w.prototype[e]=function(){var t=[this._wrapped];return s.apply(t,arguments),j.call(this,n.apply(w,t))}})};var F=0;w.uniqueId=function(t){var e=++F+"";return t?t+e:e},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var A=/(.)^/,M={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;w.template=function(t,e,n){var i;n=w.defaults({},n,w.templateSettings);var o=new RegExp([(n.escape||A).source,(n.interpolate||A).source,(n.evaluate||A).source].join("|")+"|$","g"),r=0,s="__p+='";t.replace(o,function(e,n,i,o,a){return s+=t.slice(r,a).replace(L,function(t){return"\\"+M[t]}),n&&(s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),i&&(s+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),o&&(s+="';\n"+o+"\n__p+='"),r=a+e.length,e}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{i=new Function(n.variable||"obj","_",s)}catch(a){throw a.source=s,a}if(e)return i(e,w);var l=function(t){return i.call(this,t,w)};return l.source="function("+(n.variable||"obj")+"){\n"+s+"}",l},w.chain=function(t){return w(t).chain()};var j=function(t){return this._chain?w(t).chain():t};w.mixin(w),x(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=i[t];w.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!=t&&"splice"!=t||0!==n.length||delete n[0],j.call(this,n)}}),x(["concat","join","slice"],function(t){var e=i[t];w.prototype[t]=function(){return j.call(this,e.apply(this._wrapped,arguments))}}),w.extend(w.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(){var t=[],e=t.slice,n={on:function(t,e,n){if(!o(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var i=this._events[t]||(this._events[t]=[]);return i.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,n){if(!o(this,"once",t,[e,n])||!e)return this;var i=this,r=_.once(function(){i.off(t,r),e.apply(this,arguments)});return r._callback=e,this.on(t,r,n)},off:function(t,e,n){var i,r,s,a,l,c,u,d;if(!this._events||!o(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events={},this;for(a=t?[t]:_.keys(this._events),l=0,c=a.length;c>l;l++)if(t=a[l],s=this._events[t]){if(this._events[t]=i=[],e||n)for(u=0,d=s.length;d>u;u++)r=s[u],(e&&e!==r.callback&&e!==r.callback._callback||n&&n!==r.context)&&i.push(r);i.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var n=e.call(arguments,1);if(!o(this,"trigger",t,n))return this;var i=this._events[t],s=this._events.all;return i&&r(i,n),s&&r(s,arguments),this},stopListening:function(t,e,n){var i=this._listeners;if(!i)return this;var o=!e&&!n;"object"==typeof e&&(n=this),t&&((i={})[t._listenerId]=t);for(var r in i)i[r].off(e,n,this),o&&delete this._listeners[r];return this}},i=/\s+/,o=function(t,e,n,o){if(!n)return!0;if("object"==typeof n){for(var r in n)t[e].apply(t,[r,n[r]].concat(o));return!1}if(i.test(n)){for(var s=n.split(i),a=0,l=s.length;l>a;a++)t[e].apply(t,[s[a]].concat(o));return!1}return!0},r=function(t,e){var n,i=-1,o=t.length,r=e[0],s=e[1],a=e[2];switch(e.length){case 0:for(;++i<o;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<o;)(n=t[i]).callback.call(n.ctx,r);return;case 2:for(;++i<o;)(n=t[i]).callback.call(n.ctx,r,s);return;case 3:for(;++i<o;)(n=t[i]).callback.call(n.ctx,r,s,a);return;default:for(;++i<o;)(n=t[i]).callback.apply(n.ctx,e)}},s={listenTo:"on",listenToOnce:"once"};_.each(s,function(t,e){n[e]=function(e,n,i){var o=this._listeners||(this._listeners={}),r=e._listenerId||(e._listenerId=_.uniqueId("l"));return o[r]=e,"object"==typeof n&&(i=this),e[t](n,i,this),this}}),n.bind=n.on,n.unbind=n.off,"undefined"!=typeof define&&"function"==typeof define&&define.amd&&define("eventable",[],function(){return n}),this.Eventable=n}(),function(t,e){function n(e){return e instanceof t?e:t(e)}var i,o=this;i=o.SirTrevor={},i.DEBUG=!1,i.SKIP_VALIDATION=!1,i.version="0.3.0-rc.5",i.DEFAULTS={defaultType:!1,spinner:{className:"st-spinner",lines:9,length:8,width:3,radius:6,color:"#000",speed:1.4,trail:57,shadow:!1,left:"50%",top:"50%"},blockLimit:0,blockTypeLimits:{},required:[],uploadUrl:"/attachments",baseImageUrl:"/sir-trevor-uploads/",errorsContainer:void 0},i.BlockMixins={},i.Blocks={},i.Formatters={},i.instances=[],i.Events=Eventable;var r=!1,s={bound:[],_bindFunctions:function(){this.bound.length>0&&e.bindAll.apply(null,e.union(this,this.bound))}},a={tagName:"div",className:"sir-trevor__view",attributes:{},$:function(t){return this.$el.find(t)},render:function(){return this},_ensureElement:function(){if(this.el)this._setElement(this.el);else{var n,i=e.extend({},e.result(this,"attributes"));this.id&&(i.id=this.id),this.className&&(i["class"]=this.className),i.html&&(n=i.html,delete i.html);var o=t("<"+this.tagName+">").attr(i);n&&o.html(n),this._setElement(o)}},_setElement:function(t){return this.$el=n(t),this.el=this.$el[0],this}};!function(t){function e(t){t.preventDefault()}function n(e){e.originalEvent.dataTransfer.dropEffect="copy",t(e.currentTarget).addClass("st-drag-over"),e.preventDefault()}function i(e){t(e.currentTarget).removeClass("st-drag-over"),e.preventDefault()}t.fn.dropArea=function(){return this.bind("dragenter",e).bind("dragover",n).bind("dragleave",i),this},t.fn.noDropArea=function(){return this.unbind("dragenter").unbind("dragover").unbind("dragleave"),this},t.fn.caretToEnd=function(){var t,e;return t=document.createRange(),t.selectNodeContents(this[0]),t.collapse(!1),e=window.getSelection(),e.removeAllRanges(),e.addRange(t),this}}(jQuery);var l=function(t,n){var i,o=this;i=t&&e.has(t,"constructor")?t.constructor:function(){return o.apply(this,arguments)},e.extend(i,o,n);var r=function(){this.constructor=i};return r.prototype=o.prototype,i.prototype=new r,t&&e.extend(i.prototype,t),i.__super__=o.prototype,i};i.log=function(t){!e.isUndefined(console)&&i.DEBUG&&console.log(t)},function(t,e,n){function i(t,n){var i,o=e.createElement(t||"div");for(i in n)o[i]=n[i];return o}function o(t){for(var e=1,n=arguments.length;n>e;e++)t.appendChild(arguments[e]);return t}function r(t,e,n,i){var o=["opacity",e,~~(100*t),n,i].join("-"),r=.01+100*(n/i),s=Math.max(1-(1-t)/e*(100-r),t),a=u.substring(0,u.indexOf("Animation")).toLowerCase(),l=a&&"-"+a+"-"||"";return h[o]||(p.insertRule("@"+l+"keyframes "+o+"{"+"0%{opacity:"+s+"}"+r+"%{opacity:"+t+"}"+(r+.01)+"%{opacity:1}"+(r+e)%100+"%{opacity:"+t+"}"+"100%{opacity:"+s+"}"+"}",0),h[o]=1),o}function s(t,e){var i,o,r=t.style;if(r[e]!==n)return e;for(e=e.charAt(0).toUpperCase()+e.slice(1),o=0;o<d.length;o++)if(i=d[o]+e,r[i]!==n)return i}function a(t,e){for(var n in e)t.style[s(t,n)||n]=e[n];return t}function l(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)t[o]===n&&(t[o]=i[o])}return t}function c(t){for(var e={x:t.offsetLeft,y:t.offsetTop};t=t.offsetParent;)e.x+=t.offsetLeft,e.y+=t.offsetTop;return e}var u,d=["webkit","Moz","ms","O"],h={},p=function(){var t=i("style");return o(e.getElementsByTagName("head")[0],t),t.sheet||t.styleSheet}(),f={lines:12,length:7,width:5,radius:10,rotate:0,color:"#000",speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto"},m=function b(t){return this.spin?(this.opts=l(t||{},b.defaults,f),void 0):new b(t)};m.defaults={},l(m.prototype,{spin:function(t){this.stop();var e,n,o=this,r=o.opts,s=o.el=a(i(0,{className:r.className}),{position:"relative",zIndex:r.zIndex}),l=r.radius+r.length+r.width;if(t&&(t.insertBefore(s,t.firstChild||null),n=c(t),e=c(s),a(s,{left:("auto"==r.left?n.x-e.x+(t.offsetWidth>>1):r.left+l)+"px",top:("auto"==r.top?n.y-e.y+(t.offsetHeight>>1):r.top+l)+"px"})),s.setAttribute("aria-role","progressbar"),o.lines(s,o.opts),!u){var d=0,h=r.fps,p=h/r.speed,f=(1-r.opacity)/(p*r.trail/100),m=p/r.lines;!function b(){d++;for(var t=r.lines;t;t--){var e=Math.max(1-(d+t*m)%p*f,r.opacity);o.opacity(s,r.lines-t,e,r)}o.timeout=o.el&&setTimeout(b,~~(1e3/h))}()}return o},stop:function(){var t=this.el;return t&&(clearTimeout(this.timeout),t.parentNode&&t.parentNode.removeChild(t),this.el=n),this},lines:function(t,e){function n(t,n){return a(i(),{position:"absolute",width:e.length+e.width+"px",height:e.width+"px",background:t,boxShadow:n,transformOrigin:"left",transform:"rotate("+~~(360/e.lines*l+e.rotate)+"deg) translate("+e.radius+"px"+",0)",borderRadius:(e.width>>1)+"px"})}for(var s,l=0;l<e.lines;l++)s=a(i(),{position:"absolute",top:1+~(e.width/2)+"px",transform:e.hwaccel?"translate3d(0,0,0)":"",opacity:e.opacity,animation:u&&r(e.opacity,e.trail,l,e.lines)+" "+1/e.speed+"s linear infinite"}),e.shadow&&o(s,a(n("#000","0 0 4px #000"),{top:"2px"})),o(t,o(s,n(e.color,"0 0 1px rgba(0,0,0,.1)")));return t},opacity:function(t,e,n){e<t.childNodes.length&&(t.childNodes[e].style.opacity=n)}}),!function(){function t(t,e){return i("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',e)}var e=a(i("group"),{behavior:"url(#default#VML)"});!s(e,"transform")&&e.adj?(p.addRule(".spin-vml","behavior:url(#default#VML)"),m.prototype.lines=function(e,n){function i(){return a(t("group",{coordsize:c+" "+c,coordorigin:-l+" "+-l}),{width:c,height:c})}function r(e,r,s){o(d,o(a(i(),{rotation:360/n.lines*e+"deg",left:~~r}),o(a(t("roundrect",{arcsize:1}),{width:l,height:n.width,left:n.radius,top:-n.width>>1,filter:s}),t("fill",{color:n.color,opacity:n.opacity}),t("stroke",{opacity:0}))))}var s,l=n.length+n.width,c=2*l,u=2*-(n.width+n.length)+"px",d=a(i(),{position:"absolute",top:u,left:u});if(n.shadow)for(s=1;s<=n.lines;s++)r(s,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(s=1;s<=n.lines;s++)r(s);return o(e,d)},m.prototype.opacity=function(t,e,n,i){var o=t.firstChild;i=i.shadow&&i.lines||0,o&&e+i<o.childNodes.length&&(o=o.childNodes[e+i],o=o&&o.firstChild,o=o&&o.firstChild,o&&(o.opacity=n))}):u=s(e,"animation")}(),t.Spinner=m}(window,document),i.editorStore=function(t,n,i){var o;switch(i=i||{},n){case"create":var r=e.trim(t.$el.val());if(t.dataStore={data:[]},r.length>0)try{var s=JSON.parse(r);e.isUndefined(s.data)||(t.dataStore=s)}catch(a){t.errors.push({text:"There was a problem loading the contents of the document"}),t.renderErrors(),console.log("Sorry there has been a problem with parsing the JSON"),console.log(a)}break;case"reset":t.dataStore={data:[]};break;case"add":i.data&&(t.dataStore.data.push(i.data),o=t.dataStore);break;case"save":t.$el.val(t.dataStore.data.length>0?JSON.stringify(t.dataStore):"");break;case"read":o=t.dataStore}return o?o:void 0};var c=function(){this.intialize()};e.extend(c.prototype,{intialize:function(){this.submitBtn=t("input[type='submit']");var n=[];e.each(this.submitBtn,function(e){n.push(t(e).attr("value"))}),this.submitBtnTitles=n,this.canSubmit=!0,this.globalUploadCount=0,this._bindEvents()},setSubmitButton:function(t,e){this.submitBtn.attr("value",e)},resetSubmitButton:function(){e.each(this.submitBtn,function(e,n){t(e).attr("value",this.submitBtnTitles[n])},this)},onUploadStart:function(){this.globalUploadCount++,i.log("onUploadStart called "+this.globalUploadCount),1===this.globalUploadCount&&this._disableSubmitButton()},onUploadStop:function(){this.globalUploadCount=this.globalUploadCount<=0?0:this.globalUploadCount-1,i.log("onUploadStop called "+this.globalUploadCount),0===this.globalUploadCount&&this._enableSubmitButton()},onError:function(){i.log("onError called"),this.canSubmit=!1},_disableSubmitButton:function(t){this.setSubmitButton(null,t||"Please wait..."),this.submitBtn.attr("disabled","disabled").addClass("disabled")},_enableSubmitButton:function(){this.resetSubmitButton(),this.submitBtn.removeAttr("disabled").removeClass("disabled")},_events:{disableSubmitButton:"_disableSubmitButton",enableSubmitButton:"_enableSubmitButton",setSubmitButton:"setSubmitButton",resetSubmitButton:"resetSubmitButton",onError:"onError",onUploadStart:"onUploadStart",onUploadStop:"onUploadStop"},_bindEvents:function(){e.forEach(this._events,function(t,e){i.EventBus.on(e,this[t],this)},this)}}),i.submittable=function(){new c},i.fileUploader=function(n,o,r,s){i.EventBus.trigger("onUploadStart");var a=[n.blockID,(new Date).getTime(),"raw"].join("-"),l=new FormData;l.append("attachment[name]",o.name),l.append("attachment[file]",o),l.append("attachment[uid]",a),n.resetMessages();var c=function(t){i.log("Upload callback called"),i.EventBus.trigger("onUploadStop"),!e.isUndefined(r)&&e.isFunction(r)&&e.bind(r,n)(t)},u=function(t,o){i.log("Upload callback error called"),i.EventBus.trigger("onUploadStop"),!e.isUndefined(s)&&e.isFunction(s)&&e.bind(s,n)(o)},d=t.ajax({url:i.DEFAULTS.uploadUrl,data:l,cache:!1,contentType:!1,processData:!1,type:"POST"});return n.addQueuedItem(a,d),d.done(c).fail(u).always(e.bind(n.removeQueuedItem,n,a)),d};var u=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/;e.mixin({isURI:function(t){return u.test(t)},capitalize:function(t){return t.charAt(0).toUpperCase()+t.substring(1).toLowerCase()},trim:function(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},reverse:function(t){return t.split("").reverse().join("")},flattern:function(t){var n={};return e.each(t,function(i,o){n[e.isArray(t)?i:o]=!0}),n},to_slug:function(t){return t.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-")}}),i.toHTML=function(t,n){var o=t,r="Text"===n;e.isUndefined(r)&&(r=!1),r&&(o="<div>"+o),o=o.replace(/\[([^\]]+)\]\(([^\)]+)\)/gm,function(t,e,n){return"<a href='"+n+"'>"+e.replace(/\n/g,"")+"</a>"}),o=e.reverse(e.reverse(o).replace(/_(?!\\)((_\\|[^_])*)_(?=$|[^\\])/gm,function(t,e){return">i/<"+e.replace(/\n/g,"").replace(/[\s]+$/,"")+">i<"}).replace(/\*\*(?!\\)((\*\*\\|[^\*\*])*)\*\*(?=$|[^\\])/gm,function(t,e){return">b/<"+e.replace(/\n/g,"").replace(/[\s]+$/,"")+">b<"})),o=o.replace(/^\> (.+)$/gm,"$1");var s,a;for(s in this.formatters)i.Formatters.hasOwnProperty(s)&&(a=i.Formatters[s],!e.isUndefined(a.toHTML)&&e.isFunction(a.toHTML)&&(o=a.toHTML(o)));var l;return i.Blocks.hasOwnProperty(n)&&(l=i.Blocks[n],!e.isUndefined(l.prototype.toHTML)&&e.isFunction(l.prototype.toHTML)&&(o=l.prototype.toHTML(o))),r&&(o=o.replace(/\n\n/gm,"</div><div><br></div><div>"),o=o.replace(/\n/gm,"</div><div>")),o=o.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/\n/g,"<br>").replace(/\*\*/,"").replace(/__/,""),o=o.replace(/\\\*/g,"*").replace(/\\\[/g,"[").replace(/\\\]/g,"]").replace(/\\\_/g,"_").replace(/\\\(/g,"(").replace(/\\\)/g,")").replace(/\\\-/g,"-"),r&&(o+="</div>"),o},i.toMarkdown=function(t,n){function o(t,n,i){return e.isUndefined(i)&&(i=""),"**"+n.replace(/<(.)?br(.)?>/g,"")+"**"+i}function r(t,n,i){return e.isUndefined(i)&&(i=""),"_"+n.replace(/<(.)?br(.)?>/g,"")+"_"+i}var s=t;s=s.replace(/&nbsp;/g," "),s=s.replace(/( class=(")?Mso[a-zA-Z]+(")?)/g,"").replace(/<!--(.*?)-->/g,"").replace(/\/\*(.*?)\*\//g,"").replace(/<(\/)*(meta|link|span|\\?xml:|st1:|o:|font)(.*?)>/gi,"");var a,l,c=["style","script","applet","embed","noframes","noscript"];for(l=0;l<c.length;l++)a=new RegExp("<"+c[l]+".*?"+c[l]+"(.*?)>","gi"),s=s.replace(a,"");s=s.replace(/\*/g,"\\*").replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\_/g,"\\_").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\-/g,"\\-");var u=["em","i","strong","b"];for(l=0;l<u.length;l++)a=new RegExp("<"+u[l]+"><br></"+u[l]+">","gi"),s=s.replace(a,"<br>");s=s.replace(/<(\w+)(?:\s+\w+="[^"]+(?:"\$[^"]+"[^"]+)?")*>\s*<\/\1>/gim,"").replace(/\n/gm,"").replace(/<a.*?href=[""'](.*?)[""'].*?>(.*?)<\/a>/gim,function(t,e,n){return"["+n.trim().replace(/<(.)?br(.)?>/g,"")+"]("+e+")"}).replace(/<strong>(?:\s*)(.*?)(\s)*?<\/strong>/gim,o).replace(/<b>(?:\s*)(.*?)(\s*)?<\/b>/gim,o).replace(/<em>(?:\s*)(.*?)(\s*)?<\/em>/gim,r).replace(/<i>(?:\s*)(.*?)(\s*)?<\/i>/gim,r);var d,h;for(d in this.formatters)i.Formatters.hasOwnProperty(d)&&(h=i.Formatters[d],!e.isUndefined(h.toMarkdown)&&e.isFunction(h.toMarkdown)&&(s=h.toMarkdown(s)));s=s.replace(/([^<>]+)(<div>)/g,"$1\n$2").replace(/<div><div>/g,"\n<div>").replace(/(?:<div>)([^<>]+)(?:<div>)/g,"$1\n").replace(/(?:<div>)(?:<br>)?([^<>]+)(?:<br>)?(?:<\/div>)/g,"$1\n").replace(/<\/p>/g,"\n\n").replace(/<(.)?br(.)?>/g,"\n").replace(/&lt;/g,"<").replace(/&gt;/g,">");var p;return i.Blocks.hasOwnProperty(n)&&(p=i.Blocks[n],!e.isUndefined(p.prototype.toMarkdown)&&e.isFunction(p.prototype.toMarkdown)&&(s=p.prototype.toMarkdown(s))),s=s.replace(/<\/?[^>]+(>|$)/g,"")},i.EventBus=e.extend({},i.Events),i.BlockMixins.Ajaxable={mixinName:"Ajaxable",ajaxable:!0,initializeAjaxable:function(){this._queued=[]},addQueuedItem:function(t,e){i.log("Adding queued item for "+this.blockID+" called "+t),this._queued.push({name:t,deffered:e})},removeQueuedItem:function(t){i.log("Removing queued item for "+this.blockID+" called "+t),this._queued=e.reject(this._queued,function(e){return e.name==t})},hasItemsInQueue:function(){return this._queued.length>0},resolveAllInQueue:function(){e.each(this._queued,function(t){i.log("Aborting queued request: "+t.name),t.deffered.abort()},this)}},i.BlockMixins.Droppable={mixinName:"Droppable",valid_drop_file_types:["File","Files","text/plain","text/uri-list"],initializeDroppable:function(){i.log("Adding droppable to block "+this.blockID),this.drop_options=e.extend({},i.DEFAULTS.Block.drop_options,this.drop_options);var n=t(e.template(this.drop_options.html,{block:this}));this.$editor.hide(),this.$inputs.append(n),this.$dropzone=n,this.$dropzone.dropArea().bind("drop",e.bind(this._handleDrop,this)),this.$inner.addClass("st-block__inner--droppable")},_handleDrop:function(n){n.preventDefault(),n=n.originalEvent;var o=t(n.target),r=n.dataTransfer.types;o.removeClass("st-dropzone--dragover"),!e.isUndefined(r)&&e.some(r,function(t){return e.include(this.valid_drop_file_types,t)},this)&&this.onDrop(n.dataTransfer),i.EventBus.trigger("block:content:dropped")}},i.BlockMixins.Fetchable={mixinName:"Fetchable",initializeFetchable:function(){this.withMixin(i.BlockMixins.Ajaxable)},fetch:function(n,i,o){var r=e.uniqueId(this.blockID+"_fetch"),s=t.ajax(n);return this.resetMessages(),this.addQueuedItem(r,s),e.isUndefined(i)||s.done(e.bind(i,this)),e.isUndefined(o)||s.fail(e.bind(o,this)),s.always(e.bind(this.removeQueuedItem,this,r)),s}},i.BlockMixins.Pastable={mixinName:"Pastable",initializePastable:function(){i.log("Adding pastable to block "+this.blockID),this.paste_options=e.extend({},i.DEFAULTS.Block.paste_options,this.paste_options),this.$inputs.append(e.template(this.paste_options.html,this)),this.$(".st-paste-block").bind("click",function(){t(this).select()}).bind("paste",this._handleContentPaste).bind("submit",this._handleContentPaste)}},i.BlockMixins.Uploadable={mixinName:"Uploadable",uploadsCount:0,initializeUploadable:function(){i.log("Adding uploadable to block "+this.blockID),this.withMixin(i.BlockMixins.Ajaxable),this.upload_options=e.extend({},i.DEFAULTS.Block.upload_options,this.upload_options),this.$inputs.append(e.template(this.upload_options.html,this))},uploader:function(t,e,n){return i.fileUploader(this,t,e,n)}},i.BlockPositioner=function(){var t=["<div class='st-block-positioner__inner'>","<span class='st-block-positioner__selected-value'></span>","<select class='st-block-positioner__select'></select>","</div>"].join("\n"),n=function(t,e){this.$block=t,this.instanceID=e,this.total_blocks=0,this._ensureElement(),this._bindFunctions(),this.initialize()};return e.extend(n.prototype,s,a,{bound:["onBlockCountChange","onSelectChange","toggle","show","hide"],className:"st-block-positioner",visibleClass:"st-block-positioner--is-visible",initialize:function(){this.$el.append(t),this.$select=this.$(".st-block-positioner__select"),this.$select.on("change",this.onSelectChange),i.EventBus.on(this.instanceID+":blocks:count_update",this.onBlockCountChange)},onBlockCountChange:function(t){t!=this.total_blocks&&(this.total_blocks=t,this.renderPositionList())},onSelectChange:function(){var t=this.$select.val();0!==t&&(i.EventBus.trigger(this.instanceID+":blocks:change_position",this.$block,t,1==t?"before":"after"),this.toggle())},renderPositionList:function(){for(var t="<option value='0'>Position</option>",e=1;e<=this.total_blocks;e++)t+="<option value="+e+">"+e+"</option>";this.$select.html(t)},toggle:function(){this.$select.val(0),this.$el.toggleClass(this.visibleClass)},show:function(){this.$el.addClass(this.visibleClass)},hide:function(){this.$el.removeClass(this.visibleClass)}}),n}(),i.BlockReorder=function(){var n=function(t){this.$block=t,this._ensureElement(),this._bindFunctions(),this.initialize()};return e.extend(n.prototype,s,a,{bound:["onMouseDown","onClick","onDragStart","onDragEnd","onDrag","onDrop"],className:"st-block-ui-btn st-block-ui-btn--reorder st-icon",tagName:"a",attributes:function(){return{html:"reorder",draggable:"true","data-icon":"move"}},initialize:function(){this.$el.bind("mousedown touchstart",this.onMouseDown).bind("click",this.onClick).bind("dragstart",this.onDragStart).bind("dragend touchend",this.onDragEnd).bind("drag touchmove",this.onDrag),this.$block.dropArea().bind("drop",this.onDrop)
},onMouseDown:function(){i.EventBus.trigger("block:reorder:down")},onDrop:function(n){n.preventDefault();var o=this.$block,r=n.originalEvent.dataTransfer.getData("text/plain"),s=t("#"+r);e.isUndefined(r)||e.isEmpty(s)||o.attr("id")==r||o.attr("data-instance")!=s.attr("data-instance")||o.after(s),i.EventBus.trigger("block:reorder:dropped",r)},onDragStart:function(e){var n=t(e.currentTarget).parent();e.originalEvent.dataTransfer.setDragImage(this.$block[0],n.position().left,n.position().top),e.originalEvent.dataTransfer.setData("Text",this.$block.attr("id")),i.EventBus.trigger("block:reorder:dragstart"),this.$block.addClass("st-block--dragging")},onDragEnd:function(){i.EventBus.trigger("block:reorder:dragend"),this.$block.removeClass("st-block--dragging")},onDrag:function(){},onClick:function(){},render:function(){return this}}),n}(),i.BlockDeletion=function(){var t=function(){this._ensureElement(),this._bindFunctions()};return e.extend(t.prototype,s,a,{tagName:"a",className:"st-block-ui-btn st-block-ui-btn--delete st-icon",attributes:{html:"delete","data-icon":"bin"}}),t}();var d=function(t){var n=t.attr("data-st-name")||t.attr("name");return n||(n="Field"),e.capitalize(n)};i.BlockValidations={errors:[],valid:function(){return this.performValidations(),0===this.errors.length},performValidations:function(){this.resetErrors();var t=this.$(".st-required");e.each(t,this.validateField,this),e.each(this.validations,this.runValidator,this),this.$el.toggleClass("st-block--with-errors",this.errors.length>0)},validations:[],validateField:function(e){e=t(e);var n=e.attr("contenteditable")?e.text():e.val();0===n.length&&this.setError(e,d(e)+" must not be empty")},runValidator:function(t){e.isUndefined(this[t])||this[t].call(this)},setError:function(t,e){var n=this.addMessage(e,"st-msg--error");t.addClass("st-error"),this.errors.push({field:t,reason:e,msg:n})},resetErrors:function(){e.each(this.errors,function(t){t.field.removeClass("st-error"),t.msg.remove()}),this.$messages.removeClass("st-block__messages--is-visible"),this.errors=[]}},i.BlockStore={blockStorage:{},createStore:function(t){this.blockStorage={type:this.type.toLowerCase(),data:t||{}}},save:function(){this.toData()},saveAndReturnData:function(){return this.save(),this.blockStorage},getData:function(){return this.blockStorage.data},setData:function(t){i.log("Setting data for block "+this.blockID),e.extend(this.blockStorage.data,t||{})},setAndRetrieveData:function(t){return this.setData(t),this.getData()},setAndLoadData:function(t){this.setData(t),this.beforeLoadingData()},toData:function(){},loadData:function(){},beforeLoadingData:function(){i.log("loadData for "+this.blockID),i.EventBus.trigger("editor/block/loadData"),this.loadData(this.getData())},_loadData:function(){i.log("_loadData is deprecated and will be removed in the future. Please use beforeLoadingData instead."),this.beforeLoadingData()},checkAndLoadData:function(){e.isEmpty(this.getData())||this.beforeLoadingData()}},i.SimpleBlock=function(){var n=function(t,n){this.createStore(t),this.blockID=e.uniqueId("st-block-"),this.instanceID=n,this._ensureElement(),this._bindFunctions(),this.initialize.apply(this,arguments)};return e.extend(n.prototype,s,i.Events,a,i.BlockStore,{focus:function(){},valid:function(){return!0},className:"st-block",block_template:e.template("<div class='st-block__inner'><%= editor_html %></div>"),attributes:function(){return{id:this.blockID,"data-type":this.type,"data-instance":this.instanceID}},title:function(){return e.capitalize(this.type)},blockCSSClass:function(){return this.blockCSSClass=e.to_slug(this.type),this.blockCSSClass},type:"",editorHTML:"",initialize:function(){},onBlockRender:function(){},beforeBlockRender:function(){},_setBlockInner:function(){var t=e.result(this,"editorHTML");this.$el.append(this.block_template({editor_html:t})),this.$inner=this.$el.find(".st-block__inner"),this.$inner.bind("click mouseover",function(t){t.stopPropagation()})},render:function(){return this.beforeBlockRender(),this._setBlockInner(),this._blockPrepare(),this.onBlockRender(),this},_blockPrepare:function(){this._initUI(),this._initMessages(),this.checkAndLoadData(),this.$el.addClass("st-item-ready"),this.save()},_withUIComponent:function(t,e,n){this.$ui.append(t.render().$el),e&&n&&this.$ui.on("click",e,n)},_initUI:function(){var e=t("<div>",{"class":"st-block__ui"});this.$inner.append(e),this.$ui=e,this._initUIComponents()},_initMessages:function(){var e=t("<div>",{"class":"st-block__messages"});this.$inner.prepend(e),this.$messages=e},addMessage:function(e,n){var i=t("<span>",{html:e,"class":"st-msg "+n});return this.$messages.append(i).addClass("st-block__messages--is-visible"),i},resetMessages:function(){this.$messages.html("").removeClass("st-block__messages--is-visible")},_initUIComponents:function(){this._withUIComponent(new i.BlockReorder(this.$el))}}),n.fn=n.prototype,n.extend=l,n}(),i.Block=function(){var n=function(){i.SimpleBlock.apply(this,arguments)},o=["<div class='st-block__ui-delete-controls'>","<label class='st-block__delete-label'>Delete?</label>","<a class='st-block-ui-btn st-block-ui-btn--confirm-delete st-icon' data-icon='tick'></a>","<a class='st-block-ui-btn st-block-ui-btn--deny-delete st-icon' data-icon='close'></a>","</div>"].join("\n"),r={html:['<div class="st-block__dropzone">','<span class="st-icon"><%= _.result(block, "icon_name") %></span>',"<p>Drag <span><%= block.type %></span> here</p></div>"].join("\n"),re_render_on_reorder:!1},s={html:'<input type="text" placeholder="Or paste URL here" class="st-block__paste-input st-paste-block">'},a={html:['<div class="st-block__upload-container">','<input type="file" type="st-file-upload">','<button class="st-upload-btn">...or choose a file</button>',"</div>"].join("\n")};return i.DEFAULTS.Block={drop_options:r,paste_options:s,upload_options:a},e.extend(n.prototype,i.SimpleBlock.fn,i.BlockValidations,{bound:["_handleContentPaste","_onFocus","_onBlur","onDrop","onDeleteClick","clearInsertedStyles","getSelectionForFormatter"],className:"st-block st-icon--add",attributes:function(){return e.extend(i.SimpleBlock.fn.attributes.call(this),{"data-icon-after":"add"})},icon_name:"default",validationFailMsg:function(){return this.type+" block is invalid"},editorHTML:'<div class="st-block__editor"></div>',toolbarEnabled:!0,droppable:!1,pastable:!1,uploadable:!1,fetchable:!1,ajaxable:!1,drop_options:{},paste_options:{},upload_options:{},formattable:!0,initialize:function(){},toMarkdown:function(t){return t},toHTML:function(t){return t},withMixin:function(t){if(e.isObject(t)){var n="initialize"+t.mixinName;e.isUndefined(this[n])&&(e.extend(this,t),this[n]())}},render:function(){if(this.beforeBlockRender(),this._setBlockInner(),this.$editor=this.$inner.children().first(),this.droppable||this.pastable||this.uploadable){var e=t("<div>",{"class":"st-block__inputs"});this.$inner.append(e),this.$inputs=e}return this.hasTextBlock&&this._initTextBlocks(),this.droppable&&this.withMixin(i.BlockMixins.Droppable),this.pastable&&this.withMixin(i.BlockMixins.Pastable),this.uploadable&&this.withMixin(i.BlockMixins.Uploadable),this.fetchable&&this.withMixin(i.BlockMixins.Fetchable),this.formattable&&this._initFormatting(),this._blockPrepare(),this.onBlockRender(),this},remove:function(){this.$el.remove()},loading:function(){e.isUndefined(this.spinner)||this.ready(),this.spinner=new Spinner(i.DEFAULTS.spinner),this.spinner.spin(this.$el[0]),this.$el.addClass("st--is-loading")},ready:function(){this.$el.removeClass("st--is-loading"),e.isUndefined(this.spinner)||(this.spinner.stop(),delete this.spinner)},toData:function(){i.log("toData for "+this.blockID);var n=(this.$el,{});if(this.hasTextBlock()){var o=this.getTextBlock().html();o.length>0&&(n.text=i.toMarkdown(o,this.type))}var r=!e.isUndefined(n.text)||!this.hasTextBlock();this.$('input[type="text"]').not(".st-paste-block").length>0&&this.$('input[type="text"]').each(function(e,i){i=t(i),r&&(n[i.attr("name")]=i.val())}),e.isEmpty(n)||this.setData(n)},focus:function(){this.getTextBlock().focus()},blur:function(){this.getTextBlock().blur()},onFocus:function(){this.getTextBlock().bind("focus",this._onFocus)},onBlur:function(){this.getTextBlock().bind("blur",this._onBlur)},_onFocus:function(){this.trigger("blockFocus",this.$el)},_onBlur:function(){},onDrop:function(){},onDeleteClick:function(t){t.preventDefault(),this.$inner.append(o),this.$el.addClass("st-block--delete-active");var n=this.$inner.find(".st-block__ui-delete-controls"),i=function(t){t.preventDefault(),this.trigger("removeBlock",this.blockID)},r=function(t){t.preventDefault(),this.$el.removeClass("st-block--delete-active"),n.remove()};this.$inner.on("click",".st-block-ui-btn--confirm-delete",e.bind(i,this)).on("click",".st-block-ui-btn--deny-delete",e.bind(r,this))},pastedMarkdownToHTML:function(t){return i.toHTML(i.toMarkdown(t,this.type),this.type)},onContentPasted:function(t,e){e.html(this.pastedMarkdownToHTML(e[0].innerHTML)),this.getTextBlock().caretToEnd()},beforeLoadingData:function(){this.loading(),(this.droppable||this.uploadable||this.pastable)&&(this.$editor.show(),this.$inputs.hide()),i.SimpleBlock.fn.beforeLoadingData.call(this),this.ready()},_handleContentPaste:function(n){var i=t(n.currentTarget);e.delay(e.bind(this.onContentPasted,this,n,i),0)},_getBlockClass:function(){return"st-block--"+this.className},_initUIComponents:function(){var t=new i.BlockPositioner(this.$el,this.instanceID);this._withUIComponent(t,".st-block-ui-btn--reorder",t.toggle),this._withUIComponent(new i.BlockReorder(this.$el)),this._withUIComponent(new i.BlockDeletion,".st-block-ui-btn--delete",this.onDeleteClick),this.onFocus(),this.onBlur()},_initFormatting:function(){var t;for(var n in i.Formatters)i.Formatters.hasOwnProperty(n)&&(t=i.Formatters[n],e.isUndefined(t.keyCode)||t._bindToBlock(this.$el))},_initTextBlocks:function(){this.getTextBlock().bind("paste",this._handleContentPaste).bind("keyup",this.getSelectionForFormatter).bind("mouseup",this.getSelectionForFormatter).bind("DOMNodeInserted",this.clearInsertedStyles)},getSelectionForFormatter:function(){var t=window.getSelection();""===t.toString().trim()?i.EventBus.trigger("formatter:hide"):i.EventBus.trigger("formatter:positon")},clearInsertedStyles:function(t){var e=t.target;e.removeAttribute("style")},hasTextBlock:function(){return this.getTextBlock().length>0},getTextBlock:function(){return e.isUndefined(this.text_block)&&(this.text_block=this.$(".st-text-block")),this.text_block}}),n.extend=l,n}(),i.Formatter=function(){var t=function(t){this.formatId=e.uniqueId("format-"),this._configure(t||{}),this.initialize.apply(this,arguments)},n=["title","className","cmd","keyCode","param","onClick","toMarkdown","toHTML"];return e.extend(t.prototype,{title:"",className:"",cmd:null,keyCode:null,param:null,toMarkdown:function(t){return t},toHTML:function(t){return t},initialize:function(){},_configure:function(t){this.options&&(t=e.extend({},this.options,t));for(var i=0,o=n.length;o>i;i++){var r=n[i];t[r]&&(this[r]=t[r])}this.options=t},isActive:function(){return document.queryCommandState(this.cmd)},_bindToBlock:function(t){var e=this,n=!1;t.on("keyup",".st-text-block",function(t){(17==t.which||224==t.which||91==t.which)&&(n=!1)}).on("keydown",".st-text-block",{formatter:e},function(t){(17==t.which||224==t.which||91==t.which)&&(n=!0),t.which==t.data.formatter.keyCode&&n===!0&&(document.execCommand(t.data.formatter.cmd,!1,!0),t.preventDefault(),n=!1)})}}),t.extend=l,t}(),i.Blocks.Quote=function(){var t=e.template(['<blockquote class="st-required st-text-block" contenteditable="true"></blockquote>','<label class="st-input-label">Credit</label>','<input maxlength="140" name="cite" placeholder="Credit" class="st-input-string st-required js-cite-input" type="text" />'].join("\n"));return i.Block.extend({type:"Quote",icon_name:"quote",editorHTML:function(){return t(this)},loadData:function(t){this.getTextBlock().html(i.toHTML(t.text,this.type)),this.$(".js-cite-input").val(t.cite)},toMarkdown:function(t){return t.replace(/^(.+)$/gm,"> $1")}})}(),i.Blocks.Embedly=function(){return i.Block.extend({type:"Embedly",key:"",droppable:!0,pastable:!0,fetchable:!0,icon_name:"embed",loadData:function(t){t.html?(this.$editor.addClass("st-block__editor--with-sixteen-by-nine-media"),this.$editor.html(t.html)):"photo"==t.type&&this.$editor.html('<img src="'+t.url+'" />')},onContentPasted:function(e){var n=t(e.target),i=n.val();this.handleDropPaste(i)},handleDropPaste:function(t){if(!e.isURI(t))return i.log("Must be a URL"),void 0;this.loading();var n=function(t){this.setAndLoadData(t),this.ready()},o=function(){this.ready()},r={url:this.buildAPIUrl(t),dataType:"jsonp"};this.fetch(r,e.bind(n,this),e.bind(o,this))},buildAPIUrl:function(t){return"//api.embed.ly/1/oembed?key="+this.key+"&url="+escape(t)},onDrop:function(t){this.handleDropPaste(t.getData("text/plain"))}})}(),i.Blocks.Heading=i.Block.extend({type:"Heading",editorHTML:'<div class="st-required st-text-block st-text-block--heading" contenteditable="true"></div>',icon_name:"heading",loadData:function(t){this.getTextBlock().html(i.toHTML(t.text,this.type))}}),i.Blocks.Image=i.Block.extend({type:"Image",droppable:!0,uploadable:!0,icon_name:"image",loadData:function(e){this.$editor.html(t("<img>",{src:e.file.url}))},onBlockRender:function(){this.$inputs.find("button").bind("click",function(t){t.preventDefault()}),this.$inputs.find("input").on("change",e.bind(function(t){this.onDrop(t.currentTarget)},this))},onDrop:function(e){var n=e.files[0],o="undefined"!=typeof URL?URL:"undefined"!=typeof webkitURL?webkitURL:null;/image/.test(n.type)&&(this.loading(),this.$inputs.hide(),this.$editor.html(t("<img>",{src:o.createObjectURL(n)})).show(),i.EventBus.trigger("setSubmitButton",["Please wait..."]),this.uploader(n,function(t){this.setData(t),this.ready()},function(){this.addMessage("There was a problem with your upload"),this.ready()}))}}),i.Blocks.Text=i.Block.extend({type:"Text",editorHTML:'<div class="st-required st-text-block" contenteditable="true"></div>',icon_name:"text",loadData:function(t){this.getTextBlock().html(i.toHTML(t.text,this.type))}}),i.Blocks.Tweet=function(){var n=e.template(["<blockquote class='twitter-tweet' align='center'>","<p><%= text %></p>","&mdash; <%= user.name %> (@<%= user.screen_name %>)","<a href='<%= status_url %>' data-datetime='<%= created_at %>'><%= created_at %></a>","</blockquote>",'<script src="//platform.twitter.com/widgets.js" charset="utf-8"></script>'].join("\n"));return i.Block.extend({type:"Tweet",droppable:!0,pastable:!0,fetchable:!0,drop_options:{re_render_on_reorder:!0},fetchUrl:function(t){return"/tweets/?tweet_id="+t},icon_name:"twitter",loadData:function(t){e.isUndefined(t.status_url)&&(t.status_url=""),this.$inner.find("iframe").remove(),this.$inner.prepend(n(t))},onContentPasted:function(e){var n=t(e.target),i=n.val();this.handleTwitterDropPaste(i)},handleTwitterDropPaste:function(t){if(!this.validTweetUrl(t))return i.log("Invalid Tweet URL"),void 0;var n=t.match(/[^\/]+$/);if(!e.isEmpty(n)){this.loading(),n=n[0];var o={url:this.fetchUrl(n),dataType:"json"};this.fetch(o,this.onTweetSuccess,this.onTweetFail)}},validTweetUrl:function(t){return e.isURI(t)&&-1!==t.indexOf("twitter")&&-1!==t.indexOf("status")},onTweetSuccess:function(t){var e={user:{profile_image_url:t.user.profile_image_url,profile_image_url_https:t.user.profile_image_url_https,screen_name:t.user.screen_name,name:t.user.name},id:t.id_str,text:t.text,created_at:t.created_at,entities:t.entities,status_url:"https://twitter.com/"+t.user.screen_name+"/status/"+t.id_str};this.setAndLoadData(e),this.ready()},onTweetFail:function(){this.addMessage("There was a problem fetching your tweet"),this.ready()},onDrop:function(t){var e=t.getData("text/plain");this.handleTwitterDropPaste(e)}})}(),i.Blocks.List=function(){var t='<div class="st-text-block" contenteditable="true"><ul><li></li></ul></div>';return i.Block.extend({type:"List",icon_name:"list",editorHTML:function(){return e.template(t,this)},loadData:function(t){this.getTextBlock().html("<ul>"+i.toHTML(t.text,this.type)+"</ul>")},onBlockRender:function(){this.checkForList=e.bind(this.checkForList,this),this.getTextBlock().on("click keyup",this.checkForList)},checkForList:function(){0===this.$("ul").length&&document.execCommand("insertUnorderedList",!1,!1)},toMarkdown:function(t){return t.replace(/<\/li>/gm,"\n").replace(/<\/?[^>]+(>|$)/g,"").replace(/^(.+)$/gm," - $1")},toHTML:function(t){return t=t.replace(/^ - (.+)$/gm,"<li>$1</li>").replace(/\n/gm,"")},onContentPasted:function(t,e){var n=this.pastedMarkdownToHTML(e[0].innerHTML);this.$("ul").html(n),this.getTextBlock().caretToEnd()}})}(),i.Blocks.Video=function(){var n=/http[s]?:\/\/(?:www.)?(?:(vimeo).com\/(.*))|(?:(youtu(?:be)?).(?:be|com)\/(?:watch\?v=)?([^&]*)(?:&(?:.))?)/;return i.Block.extend({type:"Video",droppable:!0,pastable:!0,icon_name:"video",loadData:function(t){this.$editor.addClass("st-block__editor--with-sixteen-by-nine-media"),"youtube"==t.source||"youtu"==t.source?this.$editor.html('<iframe src="'+window.location.protocol+"//www.youtube.com/embed/"+t.remote_id+'" width="580" height="320" frameborder="0" allowfullscreen></iframe>'):"vimeo"==t.source&&this.$editor.html('<iframe src="'+window.location.protocol+"//player.vimeo.com/video/"+t.remote_id+'?title=0&byline=0" width="580" height="320" frameborder="0"></iframe>')},onContentPasted:function(e){var n=t(e.target),i=n.val();this.handleDropPaste(i)},handleDropPaste:function(t){if(e.isURI(t)&&(-1!=t.indexOf("youtu")||-1!=t.indexOf("vimeo"))){var i={},o=t.match(n);void 0!==o[3]?(i.source=o[3],i.remote_id=o[4]):void 0!==o[1]&&(i.source=o[1],i.remote_id=o[2]),"youtu"==i.source&&(i.source="youtube"),this.setAndLoadData(i)}},onDrop:function(t){var e=t.getData("text/plain");this.handleDropPaste(e)}})}(),function(){var t=i.Formatter.extend({title:"bold",cmd:"bold",keyCode:66,text:"B"}),e=i.Formatter.extend({title:"italic",cmd:"italic",keyCode:73,text:"i"}),n=i.Formatter.extend({title:"link",iconName:"link",cmd:"CreateLink",text:"link",onClick:function(){var t=prompt("Enter a link"),e=/(ftp|http|https):\/\/./;t&&t.length>0&&(e.test(t)||(t="http://"+t),document.execCommand(this.cmd,!1,t))},isActive:function(){var t,e=window.getSelection();return e.rangeCount>0&&(t=e.getRangeAt(0).startContainer.parentNode),t&&"A"==t.nodeName}}),o=i.Formatter.extend({title:"unlink",iconName:"link",cmd:"unlink",text:"link"});i.Formatters.Bold=new t,i.Formatters.Italic=new e,i.Formatters.Link=new n,i.Formatters.Unlink=new o}(),i.BlockControl=function(){var t=function(t,e){this.type=t,this.instance_scope=e,this._ensureElement(),this.initialize()};return e.extend(t.prototype,s,a,i.Events,{tagName:"a",className:"st-block-control",attributes:function(){return{"data-type":this.type}},initialize:function(){this.block_type=i.Blocks[this.type].prototype,this.can_be_rendered=this.block_type.toolbarEnabled},render:function(){return this.$el.html('<span class="st-icon">'+e.result(this.block_type,"icon_name")+"</span>"+e.result(this.block_type,"title")),this}}),t}(),i.BlockControls=function(){var n=function(t,e){this.instance_scope=e,this.available_types=t||[],this._ensureElement(),this._bindFunctions(),this.initialize()};return e.extend(n.prototype,s,a,i.Events,{bound:["handleControlButtonClick"],block_controls:null,className:"st-block-controls",html:"<a class='st-icon st-icon--close'>close</a>",initialize:function(){for(var t in this.available_types)if(i.Blocks.hasOwnProperty(t)){var e=new i.BlockControl(t,this.instance_scope);e.can_be_rendered&&this.$el.append(e.render().$el)}this.$el.delegate(".st-block-control","click",this.handleControlButtonClick)},show:function(){this.$el.addClass("st-block-controls--active")},hide:function(){this.$el.removeClass("st-block-controls--active")},handleControlButtonClick:function(e){e.stopPropagation(),this.trigger("createBlock",t(e.currentTarget).attr("data-type"))}}),n}(),i.FloatingBlockControls=function(){var n=function(t,e){this.$wrapper=t,this.instance_id=e,this._ensureElement(),this._bindFunctions(),this.initialize()};return e.extend(n.prototype,s,a,i.Events,{className:"st-block-controls__top",attributes:function(){return{"data-icon":"add"}},bound:["handleBlockMouseOut","handleBlockMouseOver","handleBlockClick","onDrop"],initialize:function(){this.$el.on("click",this.handleBlockClick).dropArea().bind("drop",this.onDrop),this.$wrapper.on("mouseover",".st-block",this.handleBlockMouseOver).on("mouseout",".st-block",this.handleBlockMouseOut).on("click",".st-block--with-plus",this.handleBlockClick)},onDrop:function(n){n.preventDefault();var o=this.$el,r=n.originalEvent.dataTransfer.getData("text/plain"),s=t("#"+r);e.isUndefined(r)||e.isEmpty(s)||o.attr("id")==r||this.instance_id!=s.attr("data-instance")||o.after(s),i.EventBus.trigger("block:reorder:dropped",r)},handleBlockMouseOver:function(e){var n=t(e.currentTarget);n.hasClass("st-block--with-plus")||n.addClass("st-block--with-plus")},handleBlockMouseOut:function(e){var n=t(e.currentTarget);n.hasClass("st-block--with-plus")&&n.removeClass("st-block--with-plus")},handleBlockClick:function(e){e.stopPropagation();var n=t(e.currentTarget);this.trigger("showBlockControls",n)}}),n}(),i.FormatBar=function(){var n=function(t){this.options=e.extend({},i.DEFAULTS.formatBar,t||{}),this._ensureElement(),this._bindFunctions(),this.initialize.apply(this,arguments)};return e.extend(n.prototype,s,i.Events,a,{className:"st-format-bar",bound:["onFormatButtonClick","renderBySelection","hide"],initialize:function(){var e,n,o;this.$btns=[];for(e in i.Formatters)i.Formatters.hasOwnProperty(e)&&(n=i.Formatters[e],o=t("<button>",{"class":"st-format-btn st-format-btn--"+e+" "+(n.iconName?"st-icon":""),text:n.text,"data-type":e,"data-cmd":n.cmd}),this.$btns.push(o),o.appendTo(this.$el));this.$b=t(document),this.$el.bind("click",".st-format-btn",this.onFormatButtonClick)},hide:function(){this.$el.removeClass("st-format-bar--is-ready")},show:function(){this.$el.addClass("st-format-bar--is-ready")},remove:function(){this.$el.remove()},renderBySelection:function(){var t=window.getSelection(),e=t.getRangeAt(0),n=e.getBoundingClientRect(),i={};i.top=n.top+20+window.pageYOffset-this.$el.height()+"px",i.left=(n.left+n.right)/2-this.$el.width()/2+"px",this.highlightSelectedButtons(),this.show(),this.$el.css(i)},highlightSelectedButtons:function(){var t;e.each(this.$btns,function(e){t=i.Formatters[e.attr("data-type")],e.toggleClass("st-format-btn--is-active",t.isActive())},this)},onFormatButtonClick:function(n){n.stopPropagation();var o=t(n.target),r=i.Formatters[o.attr("data-type")];return e.isUndefined(r)?!1:(!e.isUndefined(r.onClick)&&e.isFunction(r.onClick)?r.onClick():document.execCommand(o.attr("data-cmd"),!1,r.param),this.highlightSelectedButtons(),!1)}}),n}(),i.Editor=function(){var o=function(t){return i.log("Init SirTrevor.Editor"),this.blockTypes={},this.blockCounts={},this.blocks=[],this.errors=[],this.options=e.extend({},i.DEFAULTS,t||{}),this.ID=e.uniqueId("st-editor-"),this._ensureAndSetElements()?(!e.isUndefined(this.options.onEditorRender)&&e.isFunction(this.options.onEditorRender)&&(this.onEditorRender=this.options.onEditorRender),this._setRequired(),this._setBlocksTypes(),this._bindFunctions(),this.store("create"),this.build(),i.instances.push(this),i.bindFormSubmit(this.$form),void 0):!1};return e.extend(o.prototype,s,i.Events,{bound:["onFormSubmit","showBlockControls","hideAllTheThings","hideBlockControls","onNewBlockCreated","changeBlockPosition","onBlockDragStart","onBlockDragEnd","removeBlockDragOver","onBlockDropped","createBlock"],events:{"block:reorder:down":"hideBlockControls","block:reorder:dragstart":"onBlockDragStart","block:reorder:dragend":"onBlockDragEnd","block:content:dropped":"removeBlockDragOver","block:reorder:dropped":"onBlockDropped","block:create:new":"onNewBlockCreated"},initialize:function(){},build:function(){this.$el.hide(),this.block_controls=new i.BlockControls(this.blockTypes,this.ID),this.fl_block_controls=new i.FloatingBlockControls(this.$wrapper,this.ID),this.formatBar=new i.FormatBar(this.options.formatBar),this.listenTo(this.block_controls,"createBlock",this.createBlock),this.listenTo(this.fl_block_controls,"showBlockControls",this.showBlockControls),this._setEvents(),i.EventBus.on(this.ID+":blocks:change_position",this.changeBlockPosition),i.EventBus.on("formatter:positon",this.formatBar.renderBySelection),i.EventBus.on("formatter:hide",this.formatBar.hide),this.$wrapper.prepend(this.fl_block_controls.render().$el),t(document.body).append(this.formatBar.render().$el),this.$outer.append(this.block_controls.render().$el),t(window).bind("click",this.hideAllTheThings);var n=this.store("read");n.data.length>0?e.each(n.data,function(t){i.log("Creating: "+t.type),this.createBlock(t.type,t.data)},this):this.options.defaultType!==!1&&this.createBlock(this.options.defaultType,{}),this.$wrapper.addClass("st-ready"),e.isUndefined(this.onEditorRender)||this.onEditorRender()},_setEvents:function(){e.each(this.events,function(t,e){i.EventBus.on(e,this[t],this)},this)},hideAllTheThings:function(){this.block_controls.hide(),this.formatBar.hide(),e.isUndefined(this.block_controls.current_container)||this.block_controls.current_container.removeClass("with-st-controls")},showBlockControls:function(t){e.isUndefined(this.block_controls.current_container)||this.block_controls.current_container.removeClass("with-st-controls"),this.block_controls.show(),t.append(this.block_controls.$el.detach()),t.addClass("with-st-controls"),this.block_controls.current_container=t},store:function(t,e){return i.editorStore(this,t,e||{})},createBlock:function(t,n){if(t=e.capitalize(t),this._blockLimitReached())return i.log("Cannot add any more blocks. Limit reached."),!1;if(!this._isBlockTypeAvailable(t))return i.log("Block type not available "+t),!1;if(!this._canAddBlockType(t))return i.log("Block Limit reached for type "+t),!1;var o=new i.Blocks[t](n,this.ID);this._renderInPosition(o.render().$el),this.listenTo(o,"removeBlock",this.removeBlock),this.blocks.push(o),this._incrementBlockTypeCount(t),o.focus(),i.EventBus.trigger(n?"block:create:existing":"block:create:new",o),i.log("Block created of type "+t),this.$wrapper.toggleClass("st--block-limit-reached",this._blockLimitReached()),this.triggerBlockCountUpdate()},onNewBlockCreated:function(t){this.hideBlockControls(),this.scrollTo(t.$el)},scrollTo:function(e){t("html, body").animate({scrollTop:e.position().top},300,"linear")},blockFocus:function(){this.block_controls.current_container=null},hideBlockControls:function(){e.isUndefined(this.block_controls.current_container)||this.block_controls.current_container.removeClass("with-st-controls"),this.block_controls.hide()},removeBlockDragOver:function(){this.$outer.find(".st-drag-over").removeClass("st-drag-over")},triggerBlockCountUpdate:function(){i.EventBus.trigger(this.ID+":blocks:count_update",this.blocks.length)},changeBlockPosition:function(t,e){e-=1;var n=this.getBlockPosition(t),i=this.$wrapper.find(".st-block").eq(e);this.getBlockPosition(i);var o=n>e?"Before":"After";i&&i.attr("id")!==t.attr("id")&&(this.hideAllTheThings(),t["insert"+o](i),this.scrollTo(t))},onBlockDropped:function(t){this.hideAllTheThings();var n=this.findBlockById(t);e.isUndefined(n)||e.isEmpty(n.getData())||!n.drop_options.re_render_on_reorder||n.beforeLoadingData()},onBlockDragStart:function(){this.hideBlockControls(),this.$wrapper.addClass("st-outer--is-reordering")},onBlockDragEnd:function(){this.removeBlockDragOver(),this.$wrapper.removeClass("st-outer--is-reordering")},_renderInPosition:function(t){this.block_controls.current_container?this.block_controls.current_container.after(t):this.$wrapper.append(t)},_incrementBlockTypeCount:function(t){this.blockCounts[t]=e.isUndefined(this.blockCounts[t])?1:this.blockCounts[t]+1},_getBlockTypeCount:function(t){return e.isUndefined(this.blockCounts[t])?0:this.blockCounts[t]},_canAddBlockType:function(t){var e=this._getBlockTypeLimit(t);return!(0!==e&&this._getBlockTypeCount(t)>=e)},_blockLimitReached:function(){return 0!==this.options.blockLimit&&this.blocks.length>=this.options.blockLimit},removeBlock:function(t){var n=this.findBlockById(t),o=n.$el.find(".st-block-controls");o.length&&(this.block_controls.hide(),this.$wrapper.prepend(o)),this.blockCounts[n.type]=this.blockCounts[n.type]-1,this.blocks=e.reject(this.blocks,function(t){return t.blockID==n.blockID}),this.stopListening(n),n.ajaxable&&n.resolveAllInQueue(),n.remove(),i.EventBus.trigger("block:remove"),this.triggerBlockCountUpdate(),this.$wrapper.toggleClass("st--block-limit-reached",this._blockLimitReached())},performValidations:function(t,n){var o=0;return!i.SKIP_VALIDATION&&n&&(t.valid()||(this.errors.push({text:e.result(t,"validationFailMsg")}),i.log("Block "+t.blockID+" failed validation"),++o)),o},saveBlockStateToStore:function(t){var n=t.saveAndReturnData();n&&!e.isEmpty(n.data)&&(i.log("Adding data for block "+t.blockID+" to block store"),this.store("add",{data:n}))},onFormSubmit:function(t){return t=t===!1?!1:!0,i.log("Handling form submission for Editor "+this.ID),this.removeErrors(),this.store("reset"),this.validateBlocks(t),this.validateBlockTypesExist(t),this.renderErrors(),this.store("save"),this.errors.length},validateBlocks:function(n){if(!this.required&&i.SKIP_VALIDATION&&!n)return!1;var o=function(i){var o=e.find(this.blocks,function(e){return e.blockID==t(i).attr("id")});return e.isUndefined(o)?!1:(this.performValidations(o,n),this.saveBlockStateToStore(o),void 0)};e.each(this.$wrapper.find(".st-block"),o,this)},validateBlockTypesExist:function(t){if(!this.required&&i.SKIP_VALIDATION&&!t)return!1;var n=function(t){if(this._isBlockTypeAvailable(t))if(0===this._getBlockTypeCount(t))i.log("Failed validation on required block type "+t),this.errors.push({text:"You must have a block of type "+t});else{var n=e.filter(this.blocks,function(n){return n.type==t&&!e.isEmpty(n.getData())});if(n.length>0)return!1;this.errors.push({text:"A required block type "+t+" is empty"}),i.log("A required block type "+t+" is empty")}};e.isArray(this.required)&&e.each(this.required,n,this)},renderErrors:function(){if(0===this.errors.length)return!1;e.isUndefined(this.$errors)&&(this.$errors=this._errorsContainer());var t="<ul>";e.each(this.errors,function(e){t+='<li class="st-errors__msg">'+e.text+"</li>"}),t+="</ul>",this.$errors.append(t),this.$errors.show()},_errorsContainer:function(){if(e.isUndefined(this.options.errorsContainer)){var i=t("<div>",{"class":"st-errors",html:"<p>You have the following errors: </p>"});return this.$outer.prepend(i),i}return n(this.options.errorsContainer)},removeErrors:function(){return 0===this.errors.length?!1:(this.$errors.hide().find("ul").html(""),this.errors=[],void 0)},findBlockById:function(t){return e.find(this.blocks,function(e){return e.blockID==t})},getBlocksByType:function(t){return e.filter(this.blocks,function(e){return e.type==t})},getBlocksByIDs:function(t){return e.filter(this.blocks,function(n){return e.contains(t,n.blockID)})},getBlockPosition:function(t){return this.$wrapper.find(".st-block").index(t)},_getBlockTypeLimit:function(t){return this._isBlockTypeAvailable(t)?parseInt(e.isUndefined(this.options.blockTypeLimits[t])?0:this.options.blockTypeLimits[t],10):0},_isBlockTypeAvailable:function(t){return!e.isUndefined(this.blockTypes[t])},_ensureAndSetElements:function(){if(e.isUndefined(this.options.el)||e.isEmpty(this.options.el))return i.log("You must provide an el"),!1;this.$el=this.options.el,this.el=this.options.el[0],this.$form=this.$el.parents("form");var n=t("<div>").attr({id:this.ID,"class":"st-outer",dropzone:"copy link move"}),o=t("<div>").attr({"class":"st-blocks"});return this.$el.wrap(n).wrap(o),this.$outer=this.$form.find("#"+this.ID),this.$wrapper=this.$outer.find(".st-blocks"),!0},_setBlocksTypes:function(){this.blockTypes=e.flattern(e.isUndefined(this.options.blockTypes)?i.Blocks:this.options.blockTypes)},_setRequired:function(){this.required=e.isArray(this.options.required)&&!e.isEmpty(this.options.required)?this.options.required:!1}}),o}(),i.setDefaults=function(t){i.DEFAULTS=e.extend(i.DEFAULTS,t||{})},i.bindFormSubmit=function(t){r||(i.submittable(),t.bind("submit",this.onFormSubmit),r=!0)},i.onBeforeSubmit=function(t){var n=0;return e.each(i.instances,function(e){n+=e.onFormSubmit(t)}),i.log("Total errors: "+n),n},i.onFormSubmit=function(t){var e=i.onBeforeSubmit();e>0&&(i.EventBus.trigger("onError"),t.preventDefault())},i.setBlockOptions=function(t,n){var o=i.Blocks[t];e.isUndefined(o)||e.extend(o.prototype,n||{})},i.runOnAllInstances=function(t){e.has(i.Editor.prototype,t)?([].unshift.call(arguments,i.instances),e.invoke.apply(e,arguments)):i.log("method doesn't exist")
}}(jQuery,_),$(function(){new SirTrevor.Editor({el:$(".js-sir-trevor-instance"),blockTypes:["Text","List","Video","Quote","Iframe"]})});