// Sir Trevor, v0.0.1

(function(a,b){var c=this,d,e={baseCSSClass:"sir-trevor",storage:"json",blockStore:{data:[]},blockIndex:0,spinner:{lines:9,length:3,width:2,radius:3,color:"#000",speed:1.4,trail:57,shadow:!1}};d=c.SirTrevor={},d.options={},d.Blocks={},d.Formatters={};var f=a({});a.subscribe=function(){f.on.apply(f,arguments)},a.unsubscribe=function(){f.off.apply(f,arguments)},a.publish=function(){f.trigger.apply(f,arguments)},function(a,b,c){function d(a){var b={x:a.offsetLeft,y:a.offsetTop};while(a=a.offsetParent)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b}function e(a){for(var b=1;b<arguments.length;b++){var d=arguments[b];for(var e in d)a[e]===c&&(a[e]=d[e])}return a}function f(a,b){for(var c in b)a.style[g(a,c)||c]=b[c];return a}function g(a,b){var d=a.style,e,f;if(d[b]!==c)return b;b=b.charAt(0).toUpperCase()+b.slice(1);for(f=0;f<k.length;f++){e=k[f]+b;if(d[e]!==c)return e}}function h(a,b,c,d){var e=["opacity",b,~~(a*100),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=m.substring(0,m.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return l[e]||(n.insertRule("@"+i+"keyframes "+e+"{"+"0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}"+"100%{opacity:"+g+"}"+"}",0),l[e]=1),e}function i(a,b,c){return c&&!c.parentNode&&i(a,c),a.insertBefore(b,c||null),a}function j(a,c){var d=b.createElement(a||"div"),e;for(e in c)d[e]=c[e];return d}var k=["webkit","Moz","ms","O"],l={},m,n=function(){var a=j("style");return i(b.getElementsByTagName("head")[0],a),a.sheet||a.styleSheet}(),o=function r(a){if(!this.spin)return new r(a);this.opts=e(a||{},r.defaults,p)},p=o.defaults={lines:12,length:7,width:5,radius:10,color:"#000",speed:1,trail:100,opacity:.25,fps:20},q=o.prototype={spin:function(a){this.stop();var b=this,c=b.el=f(j(),{position:"relative"}),e,g;a&&(g=d(i(a,c,a.firstChild)),e=d(c),f(c,{left:(a.offsetWidth>>1)-e.x+g.x+"px",top:(a.offsetHeight>>1)-e.y+g.y+"px"})),c.setAttribute("aria-role","progressbar"),b.lines(c,b.opts);if(!m){var h=b.opts,k=0,l=h.fps,n=l/h.speed,o=(1-h.opacity)/(n*h.trail/100),p=n/h.lines;(function q(){k++;for(var a=h.lines;a;a--){var d=Math.max(1-(k+a*p)%n*o,h.opacity);b.opacity(c,h.lines-a,d,h)}b.timeout=b.el&&setTimeout(q,~~(1e3/l))})()}return b},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=c),this}};q.lines=function(a,b){function c(a,c){return f(j(),{position:"absolute",width:b.length+b.width+"px",height:b.width+"px",background:a,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/b.lines*d)+"deg) translate("+b.radius+"px"+",0)",borderRadius:(b.width>>1)+"px"})}var d=0,e;for(;d<b.lines;d++)e=f(j(),{position:"absolute",top:1+~(b.width/2)+"px",transform:"translate3d(0,0,0)",opacity:b.opacity,animation:m&&h(b.opacity,b.trail,d,b.lines)+" "+1/b.speed+"s linear infinite"}),b.shadow&&i(e,f(c("#000","0 0 4px #000"),{top:"2px"})),i(a,i(e,c(b.color,"0 0 1px rgba(0,0,0,.1)")));return a},q.opacity=function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)},function(){var a=f(j("group"),{behavior:"url(#default#VML)"}),b;if(!g(a,"transform")&&a.adj){for(b=4;b--;)n.addRule(["group","roundrect","fill","stroke"][b],"behavior:url(#default#VML)");q.lines=function(a,b){function c(a,c,g){i(h,i(f(d(),{rotation:360/b.lines*a+"deg",left:~~c}),i(f(j("roundrect",{arcsize:1}),{width:e,height:b.width,left:b.radius,top:-b.width>>1,filter:g}),j("fill",{color:b.color,opacity:b.opacity}),j("stroke",{opacity:0}))))}function d(){return f(j("group",{coordsize:g+" "+g,coordorigin:-e+" "+ -e}),{width:g,height:g})}var e=b.length+b.width,g=2*e,h=d(),k=~(b.length+b.radius+b.width)+"px",l;if(b.shadow)for(l=1;l<=b.lines;l++)c(l,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(l=1;l<=b.lines;l++)c(l);return i(f(a,{margin:k+" 0 0 "+k,zoom:1}),h)},q.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}else m=g(a,"animation")}(),a.Spinner=o}(window,document);var g=d.Block=function(a){this.blockTypeId=b.uniqueId("block-"),this._configure(a||{}),this.initialize.apply(this,arguments)},h=["toolbarEnabled","dropEnabled","title","limit","editorHTML","dropzoneHTML"];b.extend(g.prototype,{initialize:function(){},loadData:function(){},onDrop:function(){},_configure:function(a){this.options&&(a=b.extend({},this.options,a));for(var c=0,d=h.length;c<d;c++){var e=h[c];a[e]&&(this[e]=a[e])}this.options=a}});var i=d.Formatter=function(a){this.formatId=b.uniqueId("format-"),this._configure(a||{}),this.className=d.options.baseCSSClass+"-format-"+this.options.className,this.initialize.apply(this,arguments)},j=["title","className","cmd","keyCode"];b.extend(i.prototype,{initialize:function(){},_configure:function(a){this.options&&(a=b.extend({},this.options,a));for(var c=0,d=j.length;c<d;c++){var e=j[c];a[e]&&(this[e]=a[e])}this.options=a}}),d.Blocks.TextBlock=new d.Block({title:"Text",toolbarEnabled:!0,dropEnabled:!1,limit:0,editorHTML:""}),d.Blocks.BlockQuote=new d.Block({title:"Quote",toolbarEnabled:!0,dropEnabled:!1,limit:0,editorHTML:"",loadData:function(a,b){a.find("input").val(b.cite)}}),d.Blocks.UnorderedList=new d.Block({title:"Unordered List",toolbarEnabled:!0,dropEnabled:!1,limit:0,editorHTML:""}),d.Formatters.Bold=new d.Formatter({title:"B",className:"bold",cmd:"bold",keyCode:66}),d.Formatters.Italic=new d.Formatter({title:"I",className:"italic",cmd:"italic",keyCode:73}),d.Formatters.Link=new d.Formatter({title:"Link",className:"link",cmd:"CreateLink"}),d.Formatters.Unlink=new d.Formatter({title:"Unlink",className:"link",cmd:"unlink"}),d.initialize=function(a){this.options=b.extend({},e,a||{})}})(jQuery,_);